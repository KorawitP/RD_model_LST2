# รายงานกระบวนการเทรน AI สำหรับการทำนายอุณหภูมิพื้นผิว (LST Prediction)

เอกสารนี้อธิบายขั้นตอนการพัฒนาโมเดล Machine Learning ในโปรเจกต์ `RD_model_LST2` เพื่อทำนายอุณหภูมิพื้นผิว (Land Surface Temperature - LST) โดยใช้ข้อมูลจากดาวเทียมและตัวแปรสิ่งแวดล้อมต่างๆ

---

## 1. ภาพรวมของโมเดล (Model Overview)

- **ประเภทโมเดล:** Random Forest Regressor (Ensemble Learning)
- **ไลบรารีที่ใช้:** Scikit-learn (`sklearn`), Pandas, Numpy
- **เป้าหมาย (Target):** การทำนายค่า LST (Land Surface Temperature)
- **ข้อมูลนำเข้า (Features):** ตัวแปรสภาพอากาศและดัชนีต่างๆ เช่น CH4, NO2, CO, NDVI, Albedo, Solar Radiation, Month, Year

---

## 2. การเตรียมข้อมูล (Preprocessing Steps)

ก่อนนำข้อมูลเข้าสู่กระบวนการเทรน มีการเตรียมข้อมูลตามลำดับดังนี้:

### 2.1 การโหลดข้อมูล (Data Loading)

- **ไฟล์ข้อมูล:** `df_final_processed.parquet` (รูปแบบ Parquet เพื่อความรวดเร็วในการอ่านข้อมูลขนาดใหญ่)
- **เครื่องมือ:** `pandas.read_parquet()`

### 2.2 การคัดเลือกตัวแปร (Feature Selection)

การคัดเลือกตัวแปรมีความสำคัญต่อความแม่นยำและการแก้ปัญหา Overfitting

- **โมเดลสุดท้าย (Final Model):** ตัดตัวแปร **LULC** (Land Use Land Cover) และ **DEM** (Digital Elevation Model) ออก เนื่องจากพบว่าไม่มีความแปรปรวน (Variance) ที่ส่งผลต่อโมเดลในชุดข้อมูลนี้
- **Features ที่ใช้จริง:** `['CH4', 'NO2', 'CO', 'NDVI', 'Albedo', 'Solar_Radiation', 'month', 'year']`

### 2.3 การจัดการค่าสูญหาย (Imputation)

เนื่องจากข้อมูลดาวเทียมอาจมีค่าบางจุดหายไป (Missing Values) จึงต้องมีการเติมค่า

- **วิธีการ:** ใช้ค่าเฉลี่ย (Mean Imputation)
- **เครื่องมือ:** `SimpleImputer(strategy='mean')`
- **เหตุผล:** เพื่อรักษาจำนวนข้อมูลไว้ให้มากที่สุดโดยไม่ส่งผลกระทบต่อการกระจายตัวของข้อมูลมากเกินไป

### 2.4 การแบ่งชุดข้อมูล (Train-Test Split)

แบ่งข้อมูลออกเป็น 2 ส่วนสำคัญเพื่อทดสอบความสามารถในการทำนายกับข้อมูลที่ไม่เคยเห็นมาก่อน

- **สัดส่วน:**
  - **Training Set (70%):** ใช้สำหรับสอนโมเดล
  - **Testing Set (30%):** ใช้สำหรับวัดผลความแม่นยำหลังเทรนเสร็จ
- **การสุ่ม:** กำหนด `random_state=42` เพื่อให้ผลลัพธ์คงที่ทุกครั้งที่รัน (Reproducibility)

---

## 3. การตั้งค่าพารามิเตอร์ (Model Configuration & Hyperparameters)

การตั้งค่าพารามิเตอร์ของ Random Forest มีวัตถุประสงค์หลักเพื่อ **ลดปัญหา Overfitting** (การจำข้อสอบแทนที่จะเข้าใจรูปแบบ) โดยมีการตั้งค่าดังนี้:

| พารามิเตอร์ (Parameter) | ค่าที่ตั้งไว้ (Setting) | ความหมายและเหตุผล (Reasoning)                                                                                                         |
| :---------------------- | :---------------------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| **`n_estimators`**      | `100`                   | จำนวนต้นไม้ในป่า (Trees). 100 ต้นเพียงพอที่จะให้ความแม่นยำที่ดีและไม่ใช้เวลาเทรนนานเกินไป                                             |
| **`max_depth`**         | `25`                    | ความลึกสูงสุดของต้นไม้. **สำคัญมาก!** การจำกัดความลึกช่วยป้องกันไม่ให้โมเดลจำรายละเอียดเล็กน้อยเกินไป (Overfitting)                   |
| **`min_samples_split`** | `20`                    | จำนวนตัวอย่างขั้นต่ำที่ต้องมีเพื่อแตกกิ่ง. ค่าที่สูงขึ้นช่วยลดความซับซ้อนของโมเดล                                                     |
| **`min_samples_leaf`**  | `10`                    | จำนวนตัวอย่างขั้นต่ำที่ต้องมีในใบสุดท้าย (Leaf node). ช่วยให้โมเดลมีความทั่วไป (Generalization) มากขึ้น                               |
| **`max_features`**      | `'sqrt'`                | จำนวน Features ที่พิจารณาในแต่ละการแตกกิ่ง. ใช้รากที่สองของจำนวน Features ทั้งหมด เพื่อเพิ่มความหลากหลายของต้นไม้ (Decorrelate trees) |
| **`n_jobs`**            | `-1`                    | ใช้ CPU ทุก Core ในการประมวลผล เพื่อความรวดเร็วสูงสุด                                                                                 |

---

## 4. กระบวนการประเมินผล (Evaluation Process)

หลังจากเทรนเสร็จ จะมีการวัดผลด้วยค่าสถิติ 3 ด้านหลัก:

### 4.1 Metrics (ตัวชี้วัด)

- **R² Score (Coefficient of Determination):** ค่าเข้าหา 1 แปลว่าแม่นยำมาก (อธิบายความแปรปรวนของข้อมูลได้ดี)
- **RMSE (Root Mean Squared Error):** ค่าความคลาดเคลื่อนเฉลี่ย (หน่วยเดียวกับ LST) ยิ่งน้อยยิ่งดี

### 4.2 Cross-Validation (5-Fold)

- แบ่งข้อมูล Train เป็น 5 ส่วนย่อย และสลับกันเทรน/เทศน์ 5 รอบ
- **ประโยชน์:** เพื่อยืนยันว่าโมเดลมีความเสถียร (Stability) ไม่ได้เก่งแค่เฉพาะบางชุดข้อมูล

### 4.3 Overfitting Check (การตรวจสอบ Overfitting)

- คำนวณ **Gap** (ช่องว่าง) ระหว่างค่า R² ของชุด Train และ Test
- **สูตร:** `Gap = R²_Train - R²_Test`
- **เกณฑ์การตัดสิน:**
  - Gap < 0.1: ดีมาก (Overfitting น้อย)
  - Gap < 0.2: ปานกลาง
  - Gap > 0.2: มีโอกาส Overfitting สูง (ต้องปรับพารามิเตอร์เพิ่ม)

---

## 5. ไฟล์สำคัญในระบบ (Key Files)

- **`train_model_final.py`**: สคริปต์หลักสำหรับการเทรนโมเดลเวอร์ชันล่าสุด (ตัด feature ที่ไม่จำเป็นออก)
- **`train_model_optimized.py`**: สคริปต์สำหรับการจูนพารามิเตอร์เน้นแก้ Overfitting
- **`check_model.py` / `inspect_model.py`**: ใช้ตรวจสอบโครงสร้างและพารามิเตอร์ของโมเดลที่บันทึกไว้
- **`requirements.txt`**: รายชื่อไลบรารีที่จำเป็นต้องติดตั้ง

---

**สรุปสำหรับผู้นำเสนอ:**
ระบบนี้ถูกออกแบบมาเพื่อสร้างสมดุลระหว่างความแม่นยำ (Accuracy) และความสามารถในการนำไปใช้กับข้อมูลใหม่ (Generalization) โดยเน้นกระบวนการ Preprocessing ที่สะอาดและการจูน Hyperparameters เพื่อป้องกัน Overfitting อย่างเคร่งครัด
