# 3.1 ภาพรวมของวิธีการดำเนินงานวิจัย

ในการศึกษานี้ ผู้วิจัยได้กำหนดขั้นตอนการดำเนินงานแบบบูรณาการ (Integrated Workflow) เพื่อพัฒนาแบบจำลองทำนายอุณหภูมิพื้นผิวดิน (LST) โดยผสานเทคโนโลยีการเรียนรู้ของเครื่อง (Machine Learning) และการเรียนรู้เชิงลึก (Deep Learning) เข้าด้วยกัน ขั้นตอนหลักประกอบด้วย 4 ระยะ ดังนี้:

1.  **การรวบรวมและเตรียมข้อมูล (Data Acquisition & Preprocessing):**
    - รวบรวมข้อมูลรายเดือนจากดาวเทียม Sentinel-5P, MODIS และ ERA5 ผ่าน Google Earth Engine (GEE)
    - ดำเนินการจัดการค่าสูญหาย (Imputation) และสุ่มตัวอย่างข้อมูล (Sampling) 30,000 จุดภาพ
    - คัดเลือกตัวแปร (Feature Selection) โดยตัดตัวแปรที่มีความแปรปรวนต่ำ (LULC, DEM) ออก

2.  **การพัฒนาแบบจำลอง (Model Development):**
    - **Model 1:** Random Forest Regressor (สำหรับการวิเคราะห์ Feature Importance)
    - **Model 2:** Deep Neural Network (DNN) (สำหรับการวิเคราะห์ความสัมพันธ์ที่ซับซ้อน)
    - **Ensemble:** การรวมผลลัพธ์เพื่อเพิ่มความแม่นยำ

3.  **การวิเคราะห์และอธิบายผล (Model Interpretation - XAI):**
    - ประยุกต์ใช้เทคนิค **SHAP (SHapley Additive exPlanations)** เพื่อ "แกะกล่องดำ" ของแบบจำลอง
    - วิเคราะห์อิทธิพลของก๊าซเรือนกระจก ($CH_4, NO_2, CO$) ที่มีต่ออุณหภูมิในเชิงพื้นที่

4.  **การประเมินและสรุปผล (Evaluation & Conclusion):**
    - ประเมินด้วยค่า $R^2$, RMSE และ Cross-Validation
    - จัดทำแผนที่แสดงการกระจายตัวของอุณหภูมิและค่าความคลาดเคลื่อน (Residual Map)

```mermaid
graph TD
    A[Data Acquisition (GEE)] --> B[Preprocessing];
    B --> C{Model Training};
    C -->|Machine Learning| D[Random Forest];
    C -->|Deep Learning| E[DNN Model];
    D --> F[Ensemble Prediction];
    E --> F;
    F --> G[Evaluation (R2, RMSE)];
    D --> H[XAI Analysis (SHAP)];
    H --> I[Conclusion];
```

# 3.2 การรวบรวมข้อมูล (Data Collection)

การวิจัยนี้ใช้ฐานข้อมูลปฐมภูมิจาก **Google Earth Engine (GEE)** ซึ่งเป็นแพลตฟอร์มประมวลผลข้อมูลภูมิสารสนเทศระดับโลก โดยทำการรวบรวมข้อมูลครอบคลุมพื้นที่ **ประเทศไทย (Thailand)** ทั้งประเทศ ในช่วงเวลาตั้งแต่ **เดือนมกราคม ค.ศ. 2018 ถึง เดือนตุลาคม ค.ศ. 2025** รวมระยะเวลาทั้งสิ้น 94 เดือน

<p align="center">
  <img src="../images/Study_Area_Map.png" alt="Study Area Map of Thailand" width="600">
  <br>
  <b>ภาพที่ 3.1:</b> ขอบเขตพื้นที่ศึกษาประเทศไทยและรายละเอียดการแบ่งเขตจังหวัด
</p>

ข้อมูลที่รวบรวมประกอบด้วยตัวแปรทั้งหมด 2 ประเภทหลัก ได้แก่

### 3.2.1 ตัวแปรตาม (Dependent Variable)

- **อุณหภูมิพื้นผิวดิน (Land Surface Temperature: LST):**
  - **แหล่งข้อมูล:** ดาวเทียม MODIS (Terra/Aqua)
  - **รายละเอียด:** ข้อมูลอุณหภูมิพื้นผิวเฉลี่ยรายเดือน (Monthly Average) ซึ่งทำหน้าที่เป็นเป้าหมาย (Target) หลักในการทำนายของแบบจำลองนี้

### 3.2.2 ตัวแปรอิสระ (Independent Variables)

ผู้วิจัยได้คัดเลือกตัวแปรทางสิ่งแวดล้อมและสภาพภูมิอากาศที่มีอิทธิพลต่ออุณหภูมิพื้นผิว จำนวน **8 ตัวแปร** ดังนี้:

1.  **ก๊าซเรือนกระจกและมลพิษทางอากาศ (Greenhouse Gases & Air Pollutants):**
    - **มีเทน (Methane: $CH_4$):** จากดาวเทียม Sentinel-5P TROPOMI
    - **ไนโตรเจนไดออกไซด์ (Nitrogen Dioxide: $NO_2$):** จากดาวเทียม Sentinel-5P TROPOMI
    - **คาร์บอนมอนอกไซด์ (Carbon Monoxide: CO):** จากดาวเทียม Sentinel-5P TROPOMI
2.  **ดัชนีพืชพรรณ (Vegetation Index):**
    - **Normalized Difference Vegetation Index (NDVI):** จากดาวเทียม MODIS เพื่อใช้เป็นตัวบ่งชี้ปริมาณและความหนาแน่นของพืชพรรณ
3.  **คุณสมบัติของพื้นผิว (Surface Properties):**
    - **ค่าการสะท้อนแสง (Albedo):** จากดาวเทียม MODIS แสดงถึงความสามารถในการสะท้อนรังสีดวงอาทิตย์ของพื้นผิว
4.  **สภาพอากาศ (Meteorological Data):**
    - **รังสีดวงอาทิตย์ (Solar Radiation):** จาก ERA5 Climate Reanalysis ซึ่งเป็นแหล่งพลังงานหลักที่ส่งผลต่ออุณหภูมิโลก
5.  **ตัวแปรเชิงเวลา (Temporal Variables):**
    - **เดือน (Month):** ตัวแปรหมวดหมู่ระบุเดือนในรอบปี (1-12) เพื่อจับรูปแบบผลกระทบตามฤดูกาล
    - **ปี (Year):** ตัวแปรระบุปีปฏิทิน (2018-2025) เพื่อจับแนวโน้มการเปลี่ยนแปลงระยะยาว

**หมายเหตุ:** เดิมการศึกษานี้ได้รวบรวมข้อมูลประเภทการใช้ประโยชน์ที่ดิน (Land Use Land Cover: LULC) และความสูงจากระดับน้ำทะเล (Digital Elevation Model: DEM) ด้วย แต่ได้ถูกคัดออกในขั้นตอนการประมวลผลข้อมูลเนื่องจากปัญหาความแปรปรวนของข้อมูล (รายละเอียดในหัวข้อ 3.3)

# 3.3 การเตรียมและประมวลผลข้อมูล (Data Preprocessing)

เพื่อให้ข้อมูลมีความพร้อมและเหมาะสมสำหรับการฝึกสอนแบบจำลองการเรียนรู้ของเครื่อง ผู้วิจัยได้ดำเนินการเตรียมและประมวลผลข้อมูลตามขั้นตอนดังนี้

### 3.3.1 การจัดการข้อมูลสูญหาย (Missing Data Imputation)

จากการตรวจสอบชุดข้อมูล พบว่าตัวแปรบางชนิด โดยเฉพาะข้อมูลก๊าซจากดาวเทียม Sentinel-5P (เช่น $CH_4, NO_2, CO$) มีข้อมูลไม่ครบถ้วนในบางช่วงเวลาหรือบางพื้นที่ ผู้วิจัยจึงใช้วิธีการประมาณค่า (Imputation) ด้วย **Simple Imputer** โดยใช้ **ค่าเฉลี่ย (Mean Strategy)** ของแต่ละตัวแปรในการเติมเต็มค่าที่หายไป เพื่อรักษารูปแบบและแนวโน้มของข้อมูลไว้ให้ครบถ้วนสมบูรณ์

### 3.3.2 การสุ่มตัวอย่างข้อมูล (Data Sampling)

เนื่องจากข้อมูลภาพถ่ายดาวเทียมครอบคลุมพื้นที่ทั้งประเทศและมีช่วงเวลายาวนาน (94 เดือน) ทำให้มีปริมาณข้อมูลดิบมหาศาล เพื่อให้สามารถประมวลผลได้อย่างมีประสิทธิภาพภายใต้ทรัพยากรการคำนวณที่มีอยู่ ผู้วิจัยจึงใช้วิธี **การสุ่มตัวอย่างแบบสุ่ม (Random Sampling)** จำนวน **30,000 จุดภาพ (Pixels)** จากพื้นที่ทั่วประเทศไทย และเนื่องจากข้อมูลแต่ละจุดภาพมีค่าอนุกรมเวลา 94 เดือน ทำให้ได้ชุดข้อมูลรวมประมาณ 2.8 ล้านแถว อย่างไรก็ตาม หลังจากกรองค่าผิดปกติออก (LST > 0) ชุดข้อมูลสุดท้ายมีจำนวน **984,274 แถว**

### 3.3.3 การคัดเลือกคุณลักษณะและการจัดการตัวแปรที่มีปัญหา (Feature Selection & Variance Thresholding)

ในขั้นตอนการตรวจสอบคุณภาพข้อมูลหลังการสุ่มตัวอย่าง ผู้วิจัยได้ทำการวิเคราะห์ความแปรปรวน (Variance Analysis) ของตัวแปรทั้งหมด และพบข้อจำกัดสำคัญในตัวแปร 2 ชนิด ได้แก่

1.  **ประเภทการใช้ประโยชน์ที่ดิน (LULC)**
2.  **ความสูงจากระดับน้ำทะเล (DEM)**

ผลการตรวจสอบพบว่า ตัวแปรทั้งสองชนิดมีค่าความแปรปรวนเป็นศูนย์ (Zero Variance) ในกลุ่มตัวอย่างที่สุ่มมา (กล่าวคือ ทุกจุดข้อมูลมีค่าเท่ากันหมด หรือมีค่าคงที่เพียงค่าเดียว) ซึ่งอาจเกิดจากข้อจำกัดของการสุ่มตัวอย่างในพื้นที่ราบขนาดใหญ่ ทำให้ตัวแปรเหล่านี้ไม่สามารถส่งผลต่อการเรียนรู้ของแบบจำลองได้ ผู้วิจัยจึงตัดสินใจ **ตัดตัวแปร LULC และ DEM ออก** จากชุดข้อมูลที่ใช้ในการฝึกสอน เพื่อลดความซับซ้อนที่ไม่จำเป็น (Noise) และเพิ่มประสิทธิภาพในการประมวลผล

### 3.3.4 การแบ่งชุดข้อมูล (Data Splitting)

ชุดข้อมูลที่ผ่านการประมวลผลแล้วจำนวน **984,274 แถว** ถูกแบ่งออกเป็น 2 ส่วน ด้วยวิธี Random Split โดยกำหนดค่า Random State เท่ากับ 42 เพื่อให้ผลการทดลองสามารถทำซ้ำได้ ดังนี้

- **ชุดข้อมูลสำหรับฝึกสอน (Training Set):** ร้อยละ 70 (688,991 แถว) ใช้สำหรับสร้างและสอนแบบจำลอง
- **ชุดข้อมูลสำหรับทดสอบ (Testing Set):** ร้อยละ 30 (295,283 แถว) ใช้สำหรับประเมินประสิทธิภาพของแบบจำลอง

# 3.4 สถาปัตยกรรมแบบจำลอง (Model Architecture)

การวิจัยนี้ใช้วิธีการผสมผสาน (Hybrid Approach) โดยพัฒนาแบบจำลอง 2 ประเภท เพื่อเปรียบเทียบประสิทธิภาพและดึงจุดเด่นของแต่ละเทคนิคมาใช้ ได้แก่ **Random Forest Regressor** (ตัวแทน Machine Learning) และ **Deep Neural Network (DNN)** (ตัวแทน Deep Learning)

### 3.4.1 แบบจำลอง Random Forest (Baseline Model)

เลือกใช้เป็นแบบจำลองหลักเนื่องจากความสามารถในการอธิบายผล (Interpretability) และจัดการข้อมูลที่มีความสัมพันธ์ไม่เป็นเชิงเส้นได้ดี

- **การตั้งค่าไฮเปอร์พารามิเตอร์ (Hyperparameters):**
  - `n_estimators`: 100
  - `max_depth`: 25
  - `min_samples_split`: 20
  - `min_samples_leaf`: 10
  - `max_features`: 'sqrt'
  - `random_state`: 42

### 3.4.2 แบบจำลอง Deep Learning (Deep Neural Network: DNN)

เพื่อเพิ่มขีดความสามารถในการเรียนรู้ความสัมพันธ์ที่ซับซ้อนแบบไม่เป็นเชิงเส้น (Non-linear) ผู้วิจัยได้พัฒนาแบบจำลอง **Deep Neural Network (DNN)** หรือโครงข่ายประสาทเทียมแบบหลายชั้น (Multi-layer Perceptron: MLP) ซึ่งมีความสามารถในการสกัดคุณลักษณะ (Feature Extraction) ได้ลึกซึ้งกว่า Machine Learning ทั่วไป

**โครงสร้างสถาปัตยกรรม (Network Architecture):**

1.  **Input Layer**: รับข้อมูลเข้า (Features = 8)
2.  **Hidden Layer 1**: จำนวน 128 Neurons (Activation = `relu`)
3.  **Hidden Layer 2**: จำนวน 64 Neurons (Activation = `relu`)
4.  **Hidden Layer 3**: จำนวน 32 Neurons (Activation = `relu`)
5.  **Output Layer**: จำนวน 1 Unit (ทำนายค่า LST)

**การตั้งค่าการฝึกสอน (Training Configuration):**

- **Algorithm**: Multi-layer Perceptron (MLPRegressor)
- **Optimizer**: Adam (Adaptive Learning Rate)
- **Loss Function**: Mean Squared Error (MSE)
- **Batch Size**: 64
- **Max Iterations**: 500 รอบ (Epochs)
- **Early Stopping**: หยุดการฝึกสอนเมื่อค่า Loss ไม่ลดลงเพื่อป้องกัน Overfitting

### 3.4.3 การผสานโมเดล (Ensemble Strategy)

นอกจากการเปรียบเทียบผลลัพธ์ของทั้งสองโมเดลแยกกันแล้ว งานวิจัยนี้ยังประยุกต์ใช้เทคนิค **Weighted Averaging Ensemble** โดยนำค่าพยากรณ์จาก RF และ DNN มาหาค่าเฉลี่ยถ่วงน้ำหนักเพื่อสร้างผลลัพธ์สุดท้ายที่มีความเสถียรสูงสุด

# 3.5 การประเมินประสิทธิภาพแบบจำลอง (Model Evaluation)

เพื่อวัดประสิทธิผลและความแม่นยำของแบบจำลองในการทำนายอุณหภูมิพื้นผิวดิน (LST) ผู้วิจัยได้ใช้เกณฑ์การประเมินทางสถิติและการตรวจสอบความถูกต้อง (Validation) ดังต่อไปนี้

### 3.5.1 ตัวชี้วัดทางสถิติ (Evaluation Metrics)

1.  **สัมประสิทธิ์การตัดสินใจ (Coefficient of Determination: $R^2$ Score):**
    - ใช้เพื่อวัดระดับความสามารถของตัวแปรอิสระในการอธิบายความแปรปรวนของตัวแปรตาม (LST)
    - ค่า $R^2$ เข้าใกล้ 1 หมายถึงแบบจำลองมีความแม่นยำสูง

2.  **รากที่สองของค่าเฉลี่ยความคลาดเคลื่อนกำลังสอง (Root Mean Squared Error: RMSE):**
    - ใช้เพื่อวัดขนาดของความผิดพลาดเฉลี่ยระหว่างค่าที่ทำนายได้กับค่าจริง ในหน่วยองศาของอุณหภูมิ
    - ค่า RMSE ยิ่งต่ำ แสดงว่าแบบจำลองมีความคลาดเคลื่อนน้อย

### 3.5.2 การตรวจสอบความถูกต้อง (Validation Methods)

นอกจากการทดสอบด้วยชุดข้อมูลทดสอบ (Testing Set) แล้ว ผู้วิจัยยังใช้วิธี **K-Fold Cross-Validation** (โดยกำหนดค่า k=5) ในการตรวจสอบความเสถียรของแบบจำลอง ข้อมูลฝึกสอนจะถูกแบ่งออกเป็น 5 ส่วนย่อย และทำการหมุนเวียนฝึกสอนและทดสอบจนครบทุกส่วน เพื่อให้มั่นใจว่าประสิทธิภาพของแบบจำลองไม่ได้เกิดจากความบังเอิญในการเลือกชุดข้อมูล (Selection Bias) และเพื่อยืนยันว่าแบบจำลองสามารถนำไปใช้กับข้อมูลชุดใหม่ได้อย่างมีประสิทธิภาพ (Generalization)

# 3.6 การแปลผลและอธิบายแบบจำลอง (Model Interpretation)

หนึ่งในความท้าทายสำคัญของการใช้แบบจำลองการเรียนรู้ของเครื่องขั้นสูง (Advanced Machine Learning) และการเรียนรู้เชิงลึก (Deep Learning) คือลักษณะความเป็น "กล่องดำ" (Black-box) ซึ่งยากต่อการอธิบายกระบวนการตัดสินใจ เพื่อให้ผลการวิจัยมีความโปร่งใสและสามารถนำไปใช้อ้างอิงทางวิทยาศาสตร์ได้ งานวิจัยนี้จึงประยุกต์ใช้เทคนิค **Explainable AI (XAI)** เพื่อวิเคราะห์อิทธิพลของตัวแปรต่างๆ ที่มีต่ออุณหภูมิพื้นผิวดิน

### 3.6.1 SHAP (SHapley Additive exPlanations)

**SHAP** เป็นวิธีการที่พัฒนาขึ้นจากทฤษฎีเกม (Game Theory) เพื่อวัดค่าการมีส่วนร่วม (Contribution) ของแต่ละฟีเจอร์ที่มีต่อผลการทำนาย ในการศึกษานี้ ผู้วิจัยใช้ SHAP ใน 2 ระดับ:

1.  **Global Interpretation:** การหาค่าเฉลี่ยของค่า SHAP (Mean Absolute SHAP Value) จากข้อมูลทั้งหมด เพื่อจัดลำดับความสำคัญของตัวแปรในภาพรวมว่า ก๊าซเรือนกระจกชนิดใด ($CH_4, NO_2, CO$) หรือปัจจัยสภาพแวดล้อมใดส่งผลต่อ LST มากที่สุด
2.  **Local Interpretation:** การวิเคราะห์ค่า SHAP ในระดับรายพิกเซลหรือรายพื้นที่ (Spatial Analysis) เพื่อทำความเข้าใจว่าในพื้นที่เฉพาะ (เช่น เขตเมือง หรือเขตเกษตรกรรม) ปัจจัยใดเป็นตัวขับเคลื่อนหลักที่ทำให้อุณหภูมิสูงขึ้นหรือลดลง ซึ่งจะช่วยให้เห็นความสัมพันธ์เชิงพื้นที่ที่ซับซ้อนได้ชัดเจนยิ่งขึ้น

### 3.6.2 Permutation Feature Importance

เพื่อยืนยันผลลัพธ์ที่ได้จาก SHAP ผู้วิจัยได้ใช้วิธี **Permutation Feature Importance** ร่วมด้วย หลักการคือการวัดประสิทธิภาพของโมเดลที่ลดลงเมื่อทำการ "สลับค่า" (Shuffle) ของฟีเจอร์หนึ่งๆ แบบสุ่ม หากการสลับค่าของฟีเจอร์ใดทำให้ค่าความแม่นยำ ($R^2$) ลดลงอย่างมาก แสดงว่าฟีเจอร์นั้นมีความสำคัญสูงต่อการทำนาย

การใช้ทั้งสองวิธีควบคู่กัน (SHAP และ Permutation Importance) จะช่วยยืนยันความถูกต้องของผลการวิเคราะห์ปัจจัยปัจจัยขับเคลื่อน (Drivers) ของปรากฏการณ์เกาะความร้อนและการเปลี่ยนแปลงอุณหภูมิในประเทศไทยได้อย่างน่าเชื่อถือ
